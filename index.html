<html>
    <head>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script src='https://d3js.org/d3.v3.min.js'></script>
        <script src="https://www.gstatic.com/firebasejs/4.9.1/firebase.js"></script>

        <script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDtbCaRrJDi1WywsroMRWbagl9-rWLUlE0",
    authDomain: "dm2518-e6d19.firebaseapp.com",
    databaseURL: "https://dm2518-e6d19.firebaseio.com",
    projectId: "dm2518-e6d19",
    storageBucket: "dm2518-e6d19.appspot.com",
    messagingSenderId: "872642898861"
  };
firebase.initializeApp(config);
var db = firebase.database();
</script>

<script src="https://cdn.firebase.com/libs/firebaseui/3.0.0/firebaseui.js"></script>
   <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.0.0/firebaseui.css" />
   <script type="text/javascript">
     // FirebaseUI config.
     var uiConfig = {
       //signInSuccessUrl: '<url-to-redirect-to-on-success>',
       signInOptions: [
         // Leave the lines as is for the providers you want to offer your users.
         firebase.auth.GoogleAuthProvider.PROVIDER_ID,

       ],
       // Terms of service url.
       //tosUrl: '<your-tos-url>'
     };

     // Initialize the FirebaseUI Widget using Firebase.
     var ui = new firebaseui.auth.AuthUI(firebase.auth());
     // The start method will wait until the DOM is loaded.
     ui.start('#firebaseui-auth-container', uiConfig);

     firebase.auth().onAuthStateChanged(function(user) {
       if (user) {
         $("#login").hide();
         console.log("logged in");
      } else {
        console.log("not logged in, wtf?")
      }
    });
   </script>

   //firebase.auth().currentUser
    </head>
    <body>
      <div id="login">
        <p> hej allihop välkommen logga in h'r
          <div id="firebaseui-auth-container"></div>
      </div>

      <form id="post">
        Name
        <input label="name" type="text" name="name">
        <br>
        Message
        <input label="message" type="text" name="message">
        <br>
        <button onclick="post('room1')">Post please</button>
      </form>

      <p id="main"></p>


      <script type="text/javascript">

        function post(room) {
          //get form data
          var form = document.getElementById("post");
          var ref = db.ref("rooms/" + room + "/messages");
          var newChildRef = ref.push();
          // set form data
          newChildRef.set({name: firebase.auth().currentUser.displayName, message: form.message.value});
        }

        // denna funktion ska användas för att populera chattrumlistans
        function onload() {
          var ref = db.ref("/");
          ref.once("value", function(snapshot) {
            snapshot.forEach(function(element) {
              Object.keys(element.val()).forEach(function(room) {
                  console.log(room);
                  //button onclick'openroom(room)'
                  // Skapa en knapp för varje rum, med id room
              })
            })
          })
        }

        // Kalla på denna funktion när ni har renderat ny chattsida, för att visa posts
        function openRoom(room) {
          var ref = db.ref("rooms/" + room + "/messages");
          ref.on("value", function(snapshot) {
            snapshot.forEach(function(post) {
              console.log(post.val().name)
              console.log(post.val().message)
            // använd hur ni vull
            })
          })
        }


      </script>

</html>
